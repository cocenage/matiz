{
  "version": 3,
  "sources": ["../../filepond-plugin-image-exif-orientation/dist/filepond-plugin-image-exif-orientation.esm.js"],
  "sourcesContent": ["/*!\r\n * FilePondPluginImageExifOrientation 1.0.11\r\n * Licensed under MIT, https://opensource.org/licenses/MIT/\r\n * Please visit https://pqina.nl/filepond/ for details.\r\n */\r\n\r\n/* eslint-disable */\r\n\r\n// test if file is of type image\r\nconst isJPEG = file => /^image\\/jpeg/.test(file.type);\r\n\r\nconst Marker = {\r\n  JPEG: 0xffd8,\r\n  APP1: 0xffe1,\r\n  EXIF: 0x45786966,\r\n  TIFF: 0x4949,\r\n  Orientation: 0x0112,\r\n  Unknown: 0xff00\r\n};\r\n\r\nconst getUint16 = (view, offset, little = false) =>\r\n  view.getUint16(offset, little);\r\nconst getUint32 = (view, offset, little = false) =>\r\n  view.getUint32(offset, little);\r\n\r\nconst getImageOrientation = file =>\r\n  new Promise((resolve, reject) => {\r\n    const reader = new FileReader();\r\n    reader.onload = function(e) {\r\n      const view = new DataView(e.target.result);\r\n\r\n      // Every JPEG file starts from binary value '0xFFD8'\r\n      if (getUint16(view, 0) !== Marker.JPEG) {\r\n        // This aint no JPEG\r\n        resolve(-1);\r\n        return;\r\n      }\r\n\r\n      const length = view.byteLength;\r\n      let offset = 2;\r\n\r\n      while (offset < length) {\r\n        const marker = getUint16(view, offset);\r\n        offset += 2;\r\n\r\n        // There's our APP1 Marker\r\n        if (marker === Marker.APP1) {\r\n          if (getUint32(view, (offset += 2)) !== Marker.EXIF) {\r\n            // no EXIF info defined\r\n            break;\r\n          }\r\n\r\n          // Get TIFF Header\r\n          const little = getUint16(view, (offset += 6)) === Marker.TIFF;\r\n          offset += getUint32(view, offset + 4, little);\r\n\r\n          const tags = getUint16(view, offset, little);\r\n          offset += 2;\r\n\r\n          for (let i = 0; i < tags; i++) {\r\n            // found the orientation tag\r\n            if (\r\n              getUint16(view, offset + i * 12, little) === Marker.Orientation\r\n            ) {\r\n              resolve(getUint16(view, offset + i * 12 + 8, little));\r\n              return;\r\n            }\r\n          }\r\n        } else if ((marker & Marker.Unknown) !== Marker.Unknown) {\r\n          // Invalid\r\n          break;\r\n        } else {\r\n          offset += getUint16(view, offset);\r\n        }\r\n      }\r\n\r\n      // Nothing found\r\n      resolve(-1);\r\n    };\r\n\r\n    // we don't need to read the entire file to get the orientation\r\n    reader.readAsArrayBuffer(file.slice(0, 64 * 1024));\r\n  });\r\n\r\nconst IS_BROWSER = (() =>\r\n  typeof window !== 'undefined' && typeof window.document !== 'undefined')();\r\nconst isBrowser = () => IS_BROWSER;\r\n\r\n// 2x1 pixel image 90CW rotated with orientation header\r\nconst testSrc =\r\n  'data:image/jpg;base64,/9j/4AAQSkZJRgABAQEASABIAAD/4QA6RXhpZgAATU0AKgAAAAgAAwESAAMAAAABAAYAAAEoAAMAAAABAAIAAAITAAMAAAABAAEAAAAAAAD/2wBDAP//////////////////////////////////////////////////////////////////////////////////////wAALCAABAAIBASIA/8QAJgABAAAAAAAAAAAAAAAAAAAAAxABAAAAAAAAAAAAAAAAAAAAAP/aAAgBAQAAPwBH/9k=';\r\n\r\n// should correct orientation if is presented in landscape, in which case the browser doesn't autocorrect\r\nlet shouldCorrect = undefined;\r\nconst testImage = isBrowser() ? new Image() : {};\r\ntestImage.onload = () =>\r\n  (shouldCorrect = testImage.naturalWidth > testImage.naturalHeight);\r\ntestImage.src = testSrc;\r\n\r\nconst shouldCorrectImageExifOrientation = () => shouldCorrect;\r\n\r\n/**\r\n * Read Image Orientation Plugin\r\n */\r\nconst plugin = ({ addFilter, utils }) => {\r\n  const { Type, isFile } = utils;\r\n\r\n  // subscribe to file load and append required info\r\n  addFilter(\r\n    'DID_LOAD_ITEM',\r\n    (item, { query }) =>\r\n      new Promise((resolve, reject) => {\r\n        // get file reference\r\n        const file = item.file;\r\n\r\n        // if this is not a jpeg image we are not interested\r\n        if (\r\n          !isFile(file) ||\r\n          !isJPEG(file) ||\r\n          !query('GET_ALLOW_IMAGE_EXIF_ORIENTATION') ||\r\n          !shouldCorrectImageExifOrientation()\r\n        ) {\r\n          // continue with the unaltered dataset\r\n          return resolve(item);\r\n        }\r\n\r\n        // get orientation from exif data\r\n        getImageOrientation(file).then(orientation => {\r\n          item.setMetadata('exif', { orientation });\r\n          resolve(item);\r\n        });\r\n      })\r\n  );\r\n\r\n  // Expose plugin options\r\n  return {\r\n    options: {\r\n      // Enable or disable image orientation reading\r\n      allowImageExifOrientation: [true, Type.BOOLEAN]\r\n    }\r\n  };\r\n};\r\n\r\n// fire pluginloaded event if running in browser, this allows registering the plugin when using async script tags\r\nconst isBrowser$1 =\r\n  typeof window !== 'undefined' && typeof window.document !== 'undefined';\r\nif (isBrowser$1) {\r\n  document.dispatchEvent(\r\n    new CustomEvent('FilePond:pluginloaded', { detail: plugin })\r\n  );\r\n}\r\n\r\nexport default plugin;\r\n"],
  "mappings": "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",
  "names": []
}
